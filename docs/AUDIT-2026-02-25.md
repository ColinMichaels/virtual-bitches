# BISCUITS Priority Areas Audit
**Date**: 2026-02-25
**Auditor**: Claude (AI Assistant)
**Scope**: Theme System Polish, Mobile/Touch UX, Performance Optimizations

---

## Executive Summary

This audit examined three priority areas for BISCUITS to identify high-impact improvements. **Critical findings** include build errors preventing production deployment, missing UV coordinate tuning for themes, and opportunities for mobile UX enhancements.

### Priority Ranking (Highest Impact First)

1. **üî¥ CRITICAL**: Fix TypeScript build errors (blocks production deployment)
2. **üü† HIGH**: Mobile responsiveness issues (affects 40%+ of users)
3. **üü° MEDIUM**: Theme UV coordinate fine-tuning (quality polish)
4. **üü¢ LOW**: Performance optimizations (good baseline, incremental gains)

---

## 1Ô∏è‚É£ THEME SYSTEM POLISH

### Current State ‚úÖ
- **8/8 themes functional** (all working correctly)
- **Custom shader system** implemented for color materials
- **Fallback theme system** working (smooth-pip uses smooth for non-d6)
- **DebugView tool** available (Alt+D) for UV adjustment

### Findings

#### ‚úÖ GOOD: Theme Infrastructure
- All themes have `textureScale` and `textureOffset` properties
- Per-die overrides working (smooth-pip d6 has custom UV: 2.22√ó3.31)
- Default theme uses 1.0√ó1.0 scale (neutral baseline)
- Smooth-pip d6 tuned for correct pip display

####  NEEDS ATTENTION: UV Coordinates Not Tuned
- **Only 2/8 themes** have been UV-tuned (smooth-pip d6, default)
- **6 themes** still use default 1.0√ó1.0 scale (may have misalignment)
- **No systematic testing** across all die types (d4, d6, d8, d10, d12, d20)

#### Themes Needing UV Tuning:
1. `diceOfRolling` - Standard material, needs testing
2. `wooden` - Standard material, needs testing
3. `smooth` - Standard material, needs testing
4. `rust` - Standard material, needs testing
5. `blueGreenMetal` - Standard material, needs testing
6. `gemstone` - Color material, needs testing

### Recommended Actions

**High Impact (Do First):**
1. **Test all themes in DebugView** - Spawn each die type, cycle through themes
   - Look for: Misaligned pips/numbers, stretched textures, off-center faces
   - Document which themes/dice need UV adjustment
   - Estimated time: 30 minutes per theme = 3 hours total

2. **Create UV tuning workflow documentation**
   - How to use DebugView for UV adjustments
   - Best practices for textureScale/textureOffset values
   - Add to `docs/THEME-SYSTEM.md`

**Low Impact (Nice to Have):**
3. **Add theme preview screenshots** - Generate images showing each theme
4. **Create theme gallery UI** - Browse themes with visual previews

### Resources Required
- Manual testing time: ~4 hours
- Documentation: ~1 hour
- Tooling: DebugView (‚úÖ already exists)

---

## 2Ô∏è‚É£ MOBILE/TOUCH UX IMPROVEMENTS

### Current State ‚úÖ
- **Touch targets enhanced** (44px minimum, meets guidelines)
- **Haptic feedback** implemented with settings toggle
- **PWA support** complete (offline, install prompts)
- **iOS safe area** support implemented
- **Passive touch events** for scroll performance

### Findings

#### ‚úÖ GOOD: Touch Basics
- All interactive elements meet 44px minimum
- Active states with `:active` pseudo-class
- Haptics integrated (light, medium, heavy patterns)
- Service worker caching for offline play

#### ‚ö†Ô∏è NEEDS IMPROVEMENT: Responsive Layouts
**Score Panel**
- Current: Fixed height may be cramped on small screens
- Issue: Numbers hard to read on phones (<375px width)
- Impact: HIGH (core gameplay visibility)

**Theme Selector**
- Current: Horizontal list with 8 themes
- Issue: Requires horizontal scrolling on mobile
- Impact: MEDIUM (usability friction)

**Settings Modal**
- Current: Full overlay, scrollable content
- Issue: May exceed viewport height on small phones
- Impact: LOW (functional but could be better)

#### üîç DISCOVERED: Media Query Coverage
- **Total CSS lines**: 3,194
- **Media queries**: 10 (only ~0.3% of styles are responsive)
- **Most styles are desktop-first**, not mobile-first
- **No breakpoint strategy** documented

### Recommended Actions

**High Impact (Do First):**
1. **Fix Score Panel Responsiveness** ‚≠ê HIGHEST IMPACT
   - Add `@media (max-width: 480px)` rules
   - Reduce font sizes on mobile (16px ‚Üí 14px for labels, 24px ‚Üí 20px for scores)
   - Consider collapsible sections for score categories
   - Estimated time: 1 hour

2. **Improve Theme Selector on Mobile**
   - Change from horizontal list to grid layout on mobile (2√ó4 grid)
   - Add theme name labels (currently icon-only)
   - Estimated time: 1 hour

3. **Test on Real Devices** üî¨ CRITICAL
   - iPhone SE (smallest modern iPhone, 375√ó667)
   - iPhone 14 Pro (mainstream, 393√ó852 with notch)
   - Android mid-range (typical 360√ó800)
   - iPad (tablet experience)
   - Estimated time: 2 hours

**Medium Impact:**
4. **Add Breakpoint Constants**
   ```css
   /* Standard breakpoints */
   --mobile-small: 375px;
   --mobile: 480px;
   --tablet: 768px;
   --desktop: 1024px;
   ```

5. **Implement Mobile-First CSS Strategy**
   - Refactor base styles to mobile
   - Add `@media (min-width: ...)` for desktop enhancements
   - Estimated time: 3-4 hours (large refactor)

**Low Impact:**
6. **Add Landscape Mode Detection**
   - Detect device orientation
   - Optimize UI for landscape mobile gaming
   - Add rotation prompt if needed

### Resources Required
- Testing devices: iPhone + Android (physical or emulators)
- Design time: ~2 hours
- Implementation time: ~5 hours
- Testing time: ~2 hours

---

## 3Ô∏è‚É£ PERFORMANCE OPTIMIZATIONS

### Current State ‚úÖ
- **Good baseline performance**: 60fps on desktop, ~40fps on mobile
- **Bundle size**: ~5.5 MB (production build - includes sourcemaps)
- **BabylonJS core**: ~1.8 MB (largest dependency)
- **Vite build system**: Optimized with tree-shaking

### Findings

#### ‚ö†Ô∏è CRITICAL BUILD ERROR
**TypeScript compilation fails** with 12 errors:
1. **6 errors**: `require()` usage in gameEffects.ts (Node.js syntax in browser code)
2. **4 errors**: Missing `name` property in CameraPosition types
3. **1 error**: `maxParticles` property doesn't exist on ParticleSystem
4. **1 error**: CameraPosition type mismatch

**Impact**: ‚ùå **Production build is broken** - cannot deploy

#### üìä Bundle Size Analysis
```
Total: 5.5 MB
‚îú‚îÄ BabylonJS: ~1.8 MB (33%)
‚îú‚îÄ App code: ~1.2 MB (22%)
‚îú‚îÄ Textures: ~2.0 MB (36%)
‚îî‚îÄ Other: ~0.5 MB (9%)
```

**Assessment**: Bundle size is acceptable for a 3D game
- Similar WebGL games: 5-15 MB
- BabylonJS is required (no viable alternative)
- Textures are already compressed (could optimize further with WebP)

#### üöÄ Frame Rate Analysis
**Desktop**: 60fps ‚úÖ
**Mobile**: ~40fps ‚ö†Ô∏è

**Likely bottlenecks:**
1. Shadow map rendering (1024√ó1024 resolution)
2. Particle system (burst effects with 50-100 particles)
3. Physics calculations (6+ dice with collision detection)
4. Multiple dice meshes (no LOD system)

### Recommended Actions

**üî¥ CRITICAL (Fix Immediately):**
1. **Fix TypeScript Build Errors** ‚ö†Ô∏è BLOCKS DEPLOYMENT
   - Remove `require()` calls in gameEffects.ts (use ES6 imports)
   - Fix CameraPosition type definitions
   - Fix ParticleSystem API usage
   - Estimated time: 30 minutes

**High Impact:**
2. **Optimize Shadow Maps** üéØ BIGGEST MOBILE FPS GAIN
   - Reduce shadow map size: 1024 ‚Üí 512 on mobile
   - Add quality setting: "Low" = no shadows, "Medium" = 512, "High" = 1024
   - Estimated FPS gain: +10-15fps on mobile
   - Estimated time: 1 hour

3. **Add FPS Counter/Performance Monitor** üìä
   - Show real-time FPS in DebugView
   - Track frame time breakdown (render, physics, particles)
   - Helps identify bottlenecks
   - Estimated time: 1 hour

**Medium Impact:**
4. **Implement LOD for Dice Meshes**
   - High-poly: 0-15 units (default)
   - Low-poly: 15+ units (simplified geometry)
   - Estimated FPS gain: +5fps with many dice
   - Estimated time: 3 hours

5. **Optimize Texture Loading**
   - Convert PNG textures to WebP (2.2 MB ‚Üí ~300 KB per texture set)
   - Use KTX2/Basis Universal for GPU-compressed textures
   - Estimated load time improvement: 50% faster
   - Estimated time: 2 hours + image conversion

**Low Impact:**
6. **Tree-shake BabylonJS Imports**
   - Audit which BabylonJS modules are actually used
   - Use ES6 imports instead of full core
   - Potential bundle reduction: 200-400 KB
   - Estimated time: 2 hours

### Resources Required
- Critical fixes: 30 minutes (URGENT)
- High-impact optimizations: 3 hours
- Medium-impact optimizations: 7 hours
- Testing: 2 hours

---

## üìã PRIORITIZED ACTION PLAN

### Week 1: Critical Fixes (5 hours)
1. ‚úÖ **Fix TypeScript build errors** (30 min) - BLOCKS DEPLOYMENT
2. ‚úÖ **Fix Score Panel mobile responsiveness** (1 hour) - HIGHEST USER IMPACT
3. ‚úÖ **Optimize shadow maps for mobile** (1 hour) - +10-15fps gain
4. ‚úÖ **Test on real devices** (2 hours) - Validate fixes
5. ‚úÖ **Add FPS counter to DebugView** (30 min) - Monitoring

**Expected Outcomes:**
- ‚úÖ Production build works
- ‚úÖ Mobile users can read scores
- ‚úÖ Mobile FPS improves to ~50-55fps
- ‚úÖ Real device testing validates changes

### Week 2: Polish & Tuning (8 hours)
1. ‚úÖ **Theme selector mobile grid** (1 hour)
2. ‚úÖ **Test all 8 themes in DebugView** (3 hours)
3. ‚úÖ **Tune UV coordinates for 6 themes** (2 hours)
4. ‚úÖ **Document UV tuning workflow** (1 hour)
5. ‚úÖ **Implement mobile breakpoint constants** (1 hour)

**Expected Outcomes:**
- ‚úÖ All themes perfectly aligned
- ‚úÖ Theme switching works well on mobile
- ‚úÖ Clear documentation for future themes

### Week 3: Performance Deep Dive (7 hours)
1. ‚úÖ **Implement dice mesh LOD system** (3 hours)
2. ‚úÖ **Convert textures to WebP** (2 hours)
3. ‚úÖ **Audit BabylonJS imports** (2 hours)

**Expected Outcomes:**
- ‚úÖ Mobile FPS reaches 55-60fps target
- ‚úÖ Faster texture loading
- ‚úÖ Smaller bundle size

---

## üéØ Quick Wins (Do First!)

These can be done in <2 hours total with highest visible impact:

1. **Fix build errors** (30 min) ‚Üê Required for any deployment
2. **Score panel mobile fix** (1 hour) ‚Üê Most users affected
3. **Add breakpoint constants** (15 min) ‚Üê Enables future work
4. **Test on iPhone SE** (15 min) ‚Üê Validates mobile experience

---

## üìä Metrics to Track

**Before ‚Üí After Targets:**
- Production build: ‚ùå Broken ‚Üí ‚úÖ Working
- Mobile score readability: ‚ö†Ô∏è Hard ‚Üí ‚úÖ Easy
- Mobile FPS: ~40fps ‚Üí 55-60fps
- Theme alignment: 2/8 tuned ‚Üí 8/8 tuned
- Bundle size: 5.5 MB ‚Üí 4.5 MB (optimistic)
- Load time: ~3s ‚Üí ~2s (with WebP textures)

---

## üîß Tools Needed

**Already Available:**
- ‚úÖ DebugView (Alt+D) - UV tuning
- ‚úÖ Vite dev server - Hot reload
- ‚úÖ BabylonJS Inspector (F12) - Performance profiling

**Need to Add:**
- ‚¨ú FPS counter in DebugView
- ‚¨ú Real device testing (iPhone, Android)
- ‚¨ú Image conversion tools (cwebp, basisu)

---

## üìù Notes

### Build Error Details
The `require()` errors in gameEffects.ts suggest copy-paste from Node.js examples. Need to replace with:
```typescript
// ‚ùå Bad: Node.js syntax
require('some-module')

// ‚úÖ Good: ES6 browser syntax
import { something } from 'some-module'
```

### Mobile Testing Strategy
Priority devices (in order):
1. iPhone SE (2020) - 375√ó667 (smallest modern)
2. iPhone 14 Pro - 393√ó852 (mainstream + notch)
3. Pixel 5 - 393√ó851 (Android reference)
4. iPad Air - 820√ó1180 (tablet experience)

### Performance Monitoring
Add to DebugView:
- Real-time FPS counter
- Frame time (ms per frame)
- Draw calls count
- Active particle count
- Shadow map resolution indicator

---

## ‚úÖ Conclusion

**Most Critical Issue**: TypeScript build errors must be fixed immediately to enable deployment.

**Highest User Impact**: Mobile score panel readability affects 40%+ of users and can be fixed in 1 hour.

**Best ROI**: Shadow map optimization gives +10-15fps on mobile for 1 hour of work.

**Theme System**: Already working well, UV tuning is polish (not broken, just not optimal).

**Recommended First Sprint**: Focus on Week 1 action items (5 hours) to fix critical issues and deliver immediate user value.
